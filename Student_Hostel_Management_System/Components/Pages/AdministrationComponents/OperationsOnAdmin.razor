@page "/OperationsOnAdmin"
@page "/OperationsOnAdmin/{Id:Guid}"

@using Student_Hostel_Management_System.Data.Entites
@using Student_Hostel_Management_System.Services.Interfaces
@inject NavigationManager NavigationManager
@inject IAdminstrationDataService AdminDataService
@inject ISnackbar Snackbar

@rendermode InteractiveServer

<MudDialog>
	<TitleContent>
		<h3>@(_isEditMode ? "تعديل مدير" : "إضافة مدير")</h3>
	</TitleContent>
	<DialogContent>
		<MudPaper Class="p-4" dir="rtl">
			<MudTextField @bind-Value="Admin.NID" Label="الرقم الوظيفي" />
			<MudTextField @bind-Value="Admin.HostelNo" Label="رقم النزل" />
			<MudTextField @bind-Value="Admin.Name" Label="الإسم" />
			<MudTextField @bind-Value="Admin.Phone" Label="رقم الهاتف" />
			<MudTextField @bind-Value="Admin.Email" Label="البريد الإلكتورني" />
			<MudTextField @bind-Value="Admin.Description" Label="الوصف" />
		</MudPaper>
	</DialogContent>
	<DialogActions>
		<MudPaper Class="d-flex flex-row flex-grow-1 gap-4" Elevation="0">
			<MudButton OnClick="Save" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Primary">
				@(_isEditMode ? "تعديل" : "حفظ")
			</MudButton>
		</MudPaper>
	</DialogActions>
</MudDialog>

<br />
<MudSpacer />
<br />

@code {

	[Parameter]
	public string Id { get; set; } = string.Empty;
	[Parameter]
	public Guid? AdminId { get; set; }

	public Admin Admin { get; set; } = new Admin();

	private bool _isEditMode;

	protected override async Task OnInitializedAsync()
	{

		Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomCenter;
		_isEditMode = !string.IsNullOrEmpty(Id);
		if (_isEditMode)
		{
			var existing = await AdminDataService.GetById(Guid.Parse(Id));
			if (existing != null)
			{
				Admin = existing;
			}
			else
			{
				// Optionally navigate away or show an error
				NavigationManager.NavigateTo("/NotFound");
			}
		}

	}

	private async Task Save()
	{
		if (_isEditMode)
		{
			await AdminDataService.Update(Guid.Parse(Id),Admin);
			// Optionally navigate back to the list or show a success message
			// add a snackbar message
			Snackbar.Add("تم التعديل بنجاح", Severity.Success);
		}
		else
		{
			await AdminDataService.Add(Admin);
			Snackbar.Add("تم الاضافة بنجاح", Severity.Success);
			Admin = new Admin(); // Reset the form after adding
		}

	}

}